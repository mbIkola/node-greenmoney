<!DOCTYPE html>
<html lang="en">
<head>
    <title><%= title %></title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel='stylesheet' href='stylesheets/style.css'/>

    <!-- Basic Styles -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

    <!-- GOOGLE FONT -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300,400,700">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        .label-info {
            background-color: transparent;
            margin-left:-0.7rem;
        }
        .label-info::after {
            content: "*";
            color: red;
        }
        .form-control-feedback {
            padding-left: 1.5rem;
            opacity: 0;
        }
        .has-error .form-control-feedback.glyphicon-remove {
            opacity: 1;
        }
        .has-success .form-control-feedback.glyphicon-ok {
            opacity: 1;
        }
        .has-feedback label~.form-control-feedback {
            right: 2.5rem;
        }
        span.logo {

            background-image: url("./691x.png");
            background-size: contain;
            background-repeat: no-repeat;
            height: 100px;
            width: 100px;
            display:inline-block;
        }

        @media (max-width: 700px) {
            .hidden-xxs {
                display: none !important;
            }
            .visible-xxs {
                display: inline-block !important;
                float: left;
            }
        }
        @media (min-width: 701px) and (max-width: 32000px) {
            .visible-xxs {
                display: none !important;
            }
        }

    </style>

</head>


<body>


<div class="container-fluid">
    <div class="media">
        <div class="media-left hidden-xxs">
            <span class="logo" alt="logo" ></span>
        </div>
        <div class="media-body">
            <h1 class="media-heading"> <span class="logo visible-xxs" alt="logo" ></span> Investor's E&nbsp;Check Portal </h1>
            <em>
                Please fill in the form to invest now. Once you have completed the form successfuly we will issue your shares.
                <br/>
                Should you wish to make any changes please <a href="mailto:noone@would.reply.here">email us here</a>.
                <br/>
                Issuance of shares can take up to 5 business days.
            </em>
        </div>
    </div>

    <div class="clearfix"></div>

    <div class="content-form">
        <form action="" >
            <div class="form-row">
                <div class="form-group col-md-6 has-feedback">
                    <label for="inputPassword4">Full Name</label><span class="label label-info">&nbsp;</span>
                    <input type="text" class="form-control" id="inputPassword4" placeholder="name" name="name" autocomplete="name" required>
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>

                <div class="form-group col-md-6 has-feedback">
                    <label for="inputEmail4">Email</label><span class="label label-info">&nbsp;</span>
                    <input type="email" class="form-control" id="inputEmail4" placeholder="Email" name="email" required autocomplete="email">
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>
            </div>




            <div class="form-row">
                <div class="form-group col-md-3 has-feedback">
                    <label for="inputEmail4">Phone</label> <span class="label label-info">&nbsp;</span>
                    <input type="tel" class="form-control" id="inputEmail4" placeholder="999-999-9999."
                           name="phone" autocomplete="phone" pattern="^[0-9]{3}-?[0-9]{3}-?[0-9]{4}$" required>
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>

                <div class="form-group col-md-3 has-feedback">
                    <label for="inputCity">City</label><span class="label label-info">&nbsp;</span>
                    <input type="text" class="form-control" id="inputCity" autocomplete="address-level2" required name="city">
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>

                <div class="form-group col-md-3 has-feedback">
                    <label for="inputState">State</label><span class="label label-info">&nbsp;</span>
                    <select id="inputState" class="form-control" name="state" autocomplete="address-level1" required>
                        <option selected value="">Choose...</option>
                        <% Object.keys(usps).forEach( function(state)  {  %>
                        <option value="<%=state%>"><%=usps[state]%></option>
                        <% }); %>


                    </select>
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>
                <div class="form-group col-md-3 has-feedback">
                    <label for="inputZip">Zip</label><span class="label label-info">&nbsp;</span>
                    <input type="text" class="form-control" id="inputZip" placeholder="99999-9999" autocomplete="postal-code" name="zip" required pattern="^[0-9]{5}(?:-[0-9]{4})?$">
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>
            </div>

            <div class="form-row ">
                <div class="form-group col-md-6 has-feedback">
                    <label for="inputAddress">Address 1</label><span class="label label-info">&nbsp;</span>
                    <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St"  required name="address1" autocomplete="address-line1">
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>
                <div class="form-group col-md-6 has-feedback">
                    <label for="inputAddress2">Address 2</label>
                    <input type="text" class="form-control" id="inputAddress2" placeholder="Apartment, studio, or floor"  name="address2" autocomplete="address-line2">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6 has-feedback">
                    <label for="bankName"> Bank Name </label><span class="label label-info">&nbsp;</span>
                    <input type="text" class="form-control" id="bankName" name="bankName" autocomplete="off"  required/>
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6 has-feedback">
                    <label for="accountNumber">
                        Account Number
                    </label><span class="label label-info">&nbsp;</span>
                    <input class="form-control"  type="text" id="accountNumber" name="accountNumber" autocomplete="off" placeholder="Account Number" required />
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>
                <div class="form-group col-md-6 has-feedback">
                    <label for="routingNumber">
                        Routing Number
                    </label><span class="label label-info">&nbsp;</span>
                    <input class="form-control"  type="text" id="routingNumber" name="routingNumber" autocomplete="off" placeholder="routing Number" required />
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>

                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6 has-feedback">
                    <label  for="checkAmount">
                        Investment
                    </label><span class="label label-info ">&nbsp;</span>
                    <select name="checkAmount" class="form-control" required>
                        <option selected value="">Choose...</option>
                        <option value="400"> $400 </option>
                        <option value="1000"> $1000 </option>
                        <option value="3000"> $3000</option>
                        <option value="5000"> $5000</option>
                        <option value="10000"> $10.000</option>
                        <option value="15000"> $15.000</option>
                        <option value="20000"> $20.000</option>
                        <option value="30000"> $30.000</option>
                        <option value="40000"> $40.000</option>
                        <option value="50000"> $50.000</option>
                        <option value="80000"> $80.000</option>
                        <option value="100000"> $100.000</option>
                        <option value="150000"> $150.000</option>
                        <option value="200000"> $200.000</option>
                        <option value="300000"> $300.000</option>
                        <option value="400000"> $400.000</option>
                        <option value="500000"> $500.000</option>
                        <option value="600000"> $600.000</option>
                        <option value="700000"> $700.000</option>
                        <option value="800000"> $800.000</option>
                        <option value="900000"> $900.000</option>
                        <option value="1000000"> $1.000.000</option>
                        <option value="2500000"> $2.500.000</option>
                        <option value="3000000"> $3.000.000</option>
                    </select>
                    <!--<input class="form-control"  type="number" id="checkAmount" name="checkAmount" placeholder="Check Amount" required pattern="^[0-9]+$" />-->
                    <span class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span class="glyphicon glyphicon-remove form-control-feedback"></span>
                </div>
                <div class="form-group col-md-12">
                    <span class="text-muted"><em><span style="color:red;">*</span> Indicates required field</em></span>
                </div>
                <div class="col-md-12">
                    <button type="submit" disabled class="btn btn-primary submit">Submit</button>
                </div>
            </div>



        </form></div>

    <div class="jumbotron hidden">
        <h1> Thank you!</h1>
        <p>This is some text explaining what just happens and what should be done next. </p>
        <p><a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a></p>
    </div>

    <script type="text/javascript">
        $(document).ready(function() {
            function post(data) {
                return fetch(window.location.pathname, {
                    headers: {'Accept': 'application/json', 'Content-Type' : 'application/json'},
                    method: 'POST',
                    credentials: 'include',
                    body: JSON.stringify(data )
                }).then(function(res) {
                    if ( res.status < 400) {
                        $('.content-form').addClass('hidden');
                        $('.jumbotron').removeClass('hidden');
                    } else {
                        console.error("Something wrong");
                        alert(res.statusText);
                    }

                });
            }


            function checkForm(mark_form_group ) {
                var has_errors = false;
                let errors = [];

                $('input[required], select').each( (index, elem) => {

                    let regexp = new RegExp($(elem).attr('pattern') || '.*');
                    let fg = $(elem).parents('.form-group:first');
                    if ( !$(elem).val() || ! regexp.test($(elem).val() ) ) {
                        has_errors = true;
                        fg.removeClass('has-success');
                        if (elem.dirty) fg.addClass('has-error');
                        errors.push($(elem).attr('name') + " is invalid ");
                    } else {
                        fg.addClass('has-success').removeClass('has-error');
                    }
                });
                if ( has_errors ) {
                    console.log(errors);
                }
                return !has_errors;
            }
            var checkTimeout = null;
            let enableSubmitButtonOnChange = () => {
                clearTimeout(checkTimeout);
                checkTimeout = setTimeout(function() {
                    if ( checkForm(true) ) {
                        $('.btn.submit').prop('disabled', false);
                    } else {
                        $('.btn.submit').prop('disabled', true);
                    }
                }, 40);
            };

            $('input').on('keyup', enableSubmitButtonOnChange);
            $('select').on('change', enableSubmitButtonOnChange);
            $('input, select').on('focus', function() { this.dirty = true; } );


            $('form').on('submit', function(e) {
                e.preventDefault();

                if ( ! checkForm(true) ) {
                    console.error("Form Invalid:");
                    return false;
                }

                var formdata = {};
                $('input, select').each( function(index,elem) {
                    formdata[ $(elem).attr('name')] = $(elem).val();
                });
                console.log("About to submit: ", formdata);

                post(formdata).then( (response) => {
                    console.log(response);
                }).catch(err => {
                    alert(err);
                });
                return false;
            });



        });

    </script>
</div>


</body>
</html>
